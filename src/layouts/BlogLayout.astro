---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description: string;
  date: string;
  author?: string;
  readTime?: string;
  tags?: string[];
  heroImage?: string;
  category?: string;
}

const { title, description, date, author = 'PepTalk Research', readTime = '8 min read', tags = [], heroImage, category } = Astro.props;

const schema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "datePublished": date,
  "author": { "@type": "Person", "name": author },
  "publisher": {
    "@type": "Organization",
    "name": "PepTalk Peptides",
    "url": "https://peptalkpeptides.com",
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://peptalkpeptides.com${Astro.url.pathname}`,
  },
};
---

<BaseLayout title={`${title} | PepTalk Peptides`} description={description} ogType="article" schema={schema}>
  <article class="max-w-3xl mx-auto px-4 py-12">
    {heroImage && (
      <div class="relative rounded-2xl overflow-hidden mb-8 max-h-[400px]">
        <img src={heroImage} alt={title} class="w-full h-full object-cover" />
        {category && (
          <span class="absolute top-4 left-4 text-[10px] font-bold uppercase tracking-wider px-3 py-1.5 rounded-full bg-black/60 backdrop-blur-sm text-white border border-white/10">
            {category}
          </span>
        )}
      </div>
    )}
    <header class="mb-10 text-center">
      <div class="flex items-center justify-center gap-3 text-xs text-gray-400 mb-4">
        <time datetime={date}>{new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
        <span>&middot;</span>
        <span>{readTime}</span>
      </div>
      <h1 class="text-3xl sm:text-4xl font-extrabold gradient-text tracking-tight leading-tight mb-4">{title}</h1>
      <p class="text-gray-300 text-lg leading-relaxed max-w-2xl mx-auto">{description}</p>
      {tags.length > 0 && (
        <div class="flex flex-wrap justify-center gap-2 mt-4">
          {tags.map(tag => (
            <span class="text-[10px] px-2 py-1 rounded-full bg-white/5 border border-white/10 text-gray-300 uppercase tracking-wider">{tag}</span>
          ))}
        </div>
      )}
    </header>

    <div class="glass-strong rounded-2xl p-6 sm:p-10 shadow-2xl">
      <div class="prose-peptide">
        <slot />
      </div>
    </div>

    <!-- Email Signup -->
    <div class="mt-10 glass-strong rounded-2xl p-6 sm:p-8 text-center space-y-4">
      <p class="text-lg font-bold gradient-text">Get peptide guides & calculator updates</p>
      <p class="text-gray-400 text-sm">Join the list. No spam — just research breakdowns and tool updates.</p>
      <form id="blog-email-form" class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
        <input
          type="email"
          name="email"
          required
          placeholder="you@email.com"
          class="input-glass flex-1 px-4 py-3 rounded-xl text-sm text-gray-100 placeholder-gray-500"
        />
        <button type="submit" class="pill-active text-white font-semibold px-6 py-3 rounded-xl text-sm whitespace-nowrap">Subscribe</button>
      </form>
      <p id="blog-email-msg" class="text-emerald-400 text-sm hidden"></p>
    </div>

    <script>
      document.addEventListener('astro:page-load', () => {
        const form = document.getElementById('blog-email-form') as HTMLFormElement | null;
        const msg = document.getElementById('blog-email-msg');
        if (!form) return;
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = new FormData(form).get('email');
          if (!email) return;
          try {
            const btn = form.querySelector('button') as HTMLButtonElement;
            btn.textContent = 'Sending...';
            btn.disabled = true;
            await fetch('https://script.google.com/macros/s/AKfycbxgagbrED6ibRPyT6ZAfHAbKQbjhNea26ScZi2qEYGMvGePlWk9METEZW_6j44xKmI/exec', {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: `email=${encodeURIComponent(email as string)}&source=blog`,
              mode: 'no-cors',
            });
            form.classList.add('hidden');
            if (msg) { msg.textContent = "You're in! Check your inbox."; msg.classList.remove('hidden'); }
          } catch {
            if (msg) { msg.textContent = 'Something went wrong. Try again.'; msg.classList.remove('hidden'); }
          }
        });
      });
    </script>

    <!-- CTA -->
    <div class="mt-6 glass rounded-2xl p-6 text-center space-y-3">
      <p class="text-lg font-bold gradient-text">Ready to get started?</p>
      <p class="text-gray-300 text-sm">Use our free calculator to get exact dosing for your research.</p>
      <div class="flex flex-col sm:flex-row gap-3 justify-center">
        <a href="/calculator" class="pill-active text-white font-semibold px-6 py-3 rounded-xl text-sm inline-block">Open Calculator</a>
        <a href="https://peptiderestore.com?discount=DKE4PDRM" target="_blank" rel="noopener noreferrer" class="shop-btn text-white font-semibold px-6 py-3 rounded-xl text-sm inline-block">Shop Peptides — 5% Off</a>
      </div>
    </div>

    <nav class="mt-8 text-center">
      <a href="/blog" class="text-gray-400 hover:text-white text-sm transition-colors">&larr; Back to all articles</a>
    </nav>
  </article>
</BaseLayout>
